"use strict";var places=[{name:"Clocktower Coffee Roasting Co.",address:"205 E Middlefield Rd #1A Mountain View, CA 94043",lat:37.3970472,lng:-122.0617372,iconType:"coffee"},{name:"Sufi Coffee Shop",address:"815 W El Camino Real Mountain View, CA 94040",lat:37.385884,lng:-122.0847306,iconType:"coffee"},{name:"Oh My Sushi",address:"2595 California St Mountain View, CA 94040",lat:37.4053954,lng:-122.1107026,iconType:"sushi"},{name:"Hon Sushi",address:"1477 Plymouth St Mountain View, CA 94043",lat:37.4163068,lng:-122.0795238,iconType:"sushi"},{name:"Satsuma Sushi",address:"705 E El Camino Real Mountain View, CA 94040",lat:37.3755308,lng:-122.0638239,iconType:"sushi"}],icons={sushi:{icon:"dist/images/sushi.png"},coffee:{icon:"dist/images/coffee.png"}},Marker=function(e){var n=this;n.name=e.name,n.address=e.address,n.lat=e.lat,n.lng=e.lng,n.iconType=e.iconType,n.infoWindowContent=null,n.mapMarker=null,n.activate=null,n.setInfoWindowContent=function(e){n.infoWindowContent=e},n.setMapMarker=function(e){n.mapMarker=e},n.setActivate=function(e){n.activate=e}},ViewModel=function(){function e(e){return function(){n(e)}}function n(e){if(e.mapMarker.setAnimation(google.maps.Animation.BOUNCE),setTimeout(function(){e.mapMarker.setAnimation(null)},1400),null!==e.infoWindowContent)c.setContent(e.infoWindowContent),c.open(a,e.mapMarker);else{var n=e.lat+","+e.lng,i="https://maps.googleapis.com/maps/api/streetview?size=100x100&location="+n,r="O4L3T0YIVRWVHCWIQ1Y1UHUXUDRBQ3S4AXKT4ZIQTSIKQMNN",s="5KVONUBGB0YJZJFMTAIXKGCMRB15KEVAGRY2YWMCCZF03EXC",l="https://api.foursquare.com/v2/venues/search?client_id="+r+"&client_secret="+s+"&v=20130815&query="+e.name+"&intent=match&ll="+n;$.getJSON(l,function(n){var a="https://api.foursquare.com/v2/venues/"+n.response.venues[0].id+"?client_id="+r+"&client_secret="+s+"&v=20130815";$.getJSON(a,function(n){o(e,i,n.response.venue)}).error(function(){t(e)})}).error(function(){t(e)})}}function o(e,n,o){var t=o.location.address+", "+o.location.city+", "+o.location.postalCode+", "+o.location.state,i="Rating: "+o.rating+"/10",r=document.createElement("div");r.setAttribute("class","info-window-container");var s=document.getElementById("inforWindowTemplate").content;s.getElementById("info-image").src=n,s.getElementById("venue-name").innerHTML=o.name,s.getElementById("venue-address").innerHTML=t,s.getElementById("venue-rating").innerHTML=i,s.getElementById("details-link").href=i,o.hasOwnProperty("phrases")&&(s.getElementById("review").innerHTML=o.phrases[0].sample.text);var l=document.importNode(s,!0);r.appendChild(l),e.setInfoWindowContent(r),c.setContent(r),c.open(a,e.mapMarker)}function t(e){var n=new google.maps.InfoWindow({content:"<div class='error-message'>Failed to load venue details from foursquare server</div>"});n.open(a,e.mapMarker)}function i(e){for(var n=l.filteredMarkers().length,o=0;n>o;o++)l.filteredMarkers()[o].mapMarker.setMap(e)}var a,r=37.4006792,s=-122.068216,l=this;l.markers=ko.observableArray([]),l.filteredMarkers=ko.observableArray([]);var d;l.query=ko.observable("");var c;l.initializeMap=function(){places.forEach(function(e){l.markers.push(new Marker(e))}),d=l.markers().length;for(var e=0;d>e;e++)l.filteredMarkers.push(l.markers()[e]);var n=document.getElementById("map-canvas"),o={center:new google.maps.LatLng(r,s),zoom:13,mapTypeId:google.maps.MapTypeId.ROADMAP,panControl:!1,zoomControl:!0,zoomControlOptions:{position:google.maps.ControlPosition.RIGHT_TOP},scaleControl:!0};a=new google.maps.Map(n,o);var t=new google.maps.LatLng(37.3989458,-122.1107519),i=new google.maps.LatLng(37.4024914,-122.0527303),m=new google.maps.LatLngBounds(t,i);a.fitBounds(m),window.addEventListener("resize",function(e){a.fitBounds(m)}),c=new google.maps.InfoWindow},l.initializeMarkers=function(){for(var o=0;d>o;o++){var t=l.markers()[o],i=new google.maps.Marker({position:new google.maps.LatLng(t.lat,t.lng),map:a,icon:icons[t.iconType].icon});t.setMapMarker(i),t.setActivate(n),i.addListener("click",e(t))}},l.filter=function(){i(null),l.filteredMarkers.removeAll();for(var e,n=0;d>n;n++)e=l.markers()[n],(-1!=e.name.toLowerCase().indexOf(l.query().toLowerCase())||-1!=e.address.toLowerCase().indexOf(l.query().toLowerCase()))&&l.filteredMarkers.push(e);i(a)},l.toggleListView=function(){var e=$(".list-data").css("display");"block"===e?($(".list-data").hide("slow"),$(".hide-list").hide(),$(".show-list").show(),e=!1):($(".list-data").show("slow"),$(".show-list").hide(),$(".hide-list").show(),e=!0)}},viewModel=new ViewModel;ko.applyBindings(viewModel),viewModel.initializeMap(),viewModel.initializeMarkers(),viewModel.query.subscribe(function(){viewModel.filter()});