"use strict";var places=[{name:"Clocktower Coffee Roasting Co.",address:"205 E Middlefield Rd #1A Mountain View, CA 94043",lat:37.3970472,lng:-122.0617372,iconType:"coffee"},{name:"Sufi Coffee Shop",address:"815 W El Camino Real Mountain View, CA 94040",lat:37.385884,lng:-122.0847306,iconType:"coffee"},{name:"Oh My Sushi",address:"2595 California St Mountain View, CA 94040",lat:37.4053954,lng:-122.1107026,iconType:"sushi"},{name:"Hon Sushi",address:"1477 Plymouth St Mountain View, CA 94043",lat:37.4163068,lng:-122.0795238,iconType:"sushi"},{name:"Satsuma Sushi",address:"705 E El Camino Real Mountain View, CA 94040",lat:37.3755308,lng:-122.0638239,iconType:"sushi"}],icons={sushi:{icon:"dist/images/sushi.png"},coffee:{icon:"dist/images/coffee.png"}},Marker=function(e){var n=this;n.name=e.name,n.address=e.address,n.lat=e.lat,n.lng=e.lng,n.iconType=e.iconType,n.infoWindowContent=null,n.mapMarker=null,n.activate=null,n.setInfoWindowContent=function(e){n.infoWindowContent=e},n.setMapMarker=function(e){n.mapMarker=e},n.setActivate=function(e){n.activate=e}},ViewModel=function(){function e(e){return function(){n(e)}}function n(e){function n(n){c.onreadystatechange=function(){if(4==c.readyState&&200==c.status){var n=JSON.parse(c.responseText);t(e,s,n.response.venue)}else 4==c.readyState&&200!==c.status&&o(e)},c.open("GET",n,!0),c.send()}if(e.mapMarker.setAnimation(google.maps.Animation.BOUNCE),setTimeout(function(){e.mapMarker.setAnimation(null)},1400),null!==e.infoWindowContent)p.setContent(e.infoWindowContent),p.open(i,e.mapMarker);else{var a=e.lat+","+e.lng,s="https://maps.googleapis.com/maps/api/streetview?size=100x100&location="+a,r="O4L3T0YIVRWVHCWIQ1Y1UHUXUDRBQ3S4AXKT4ZIQTSIKQMNN",l="5KVONUBGB0YJZJFMTAIXKGCMRB15KEVAGRY2YWMCCZF03EXC",d="https://api.foursquare.com/v2/venues/search?client_id="+r+"&client_secret="+l+"&v=20130815&query="+e.name+"&intent=match&ll="+a,c=new XMLHttpRequest;c.onreadystatechange=function(){if(4==this.readyState&&200==this.status){var t=JSON.parse(this.responseText),a="https://api.foursquare.com/v2/venues/"+t.response.venues[0].id+"?client_id="+r+"&client_secret="+l+"&v=20130815";n(a)}else 4==this.readyState&&200!==this.status&&o(e)},c.open("GET",d,!0),c.send()}}function t(e,n,t){var o=t.location.address+", "+t.location.city+", "+t.location.postalCode+", "+t.location.state,a="Rating: "+t.rating+"/10",s=t.canonicalUrl,r=document.createElement("div");r.setAttribute("class","info-window-container");var l=document.getElementById("inforWindowTemplate").content;l.getElementById("info-image").src=n,l.getElementById("venue-name").innerHTML=t.name,l.getElementById("venue-address").innerHTML=o,l.getElementById("venue-rating").innerHTML=a,l.getElementById("details-link").href=s,t.hasOwnProperty("phrases")&&(l.getElementById("review").innerHTML=t.phrases[0].sample.text);var d=document.importNode(l,!0);r.appendChild(d),e.setInfoWindowContent(r),p.setContent(r),p.open(i,e.mapMarker)}function o(e){var n=new google.maps.InfoWindow({content:"<div class='error-message'>Failed to load venue details from foursquare server</div>"});n.open(i,e.mapMarker)}function a(e){for(var n=l.filteredMarkers().length,t=0;n>t;t++)l.filteredMarkers()[t].mapMarker.setMap(e)}var i,s=37.4006792,r=-122.068216,l=this;l.markers=ko.observableArray([]),l.filteredMarkers=ko.observableArray([]);var d;l.query=ko.observable("");var p;l.initializeMap=function(){places.forEach(function(e){l.markers.push(new Marker(e))}),d=l.markers().length;for(var e=0;d>e;e++)l.filteredMarkers.push(l.markers()[e]);var n=document.getElementById("map-canvas"),t={center:new google.maps.LatLng(s,r),zoom:13,mapTypeId:google.maps.MapTypeId.ROADMAP,panControl:!1,zoomControl:!0,zoomControlOptions:{position:google.maps.ControlPosition.RIGHT_TOP},mapTypeControlOptions:{position:google.maps.ControlPosition.TOP_CENTER},scaleControl:!0};i=new google.maps.Map(n,t);var o=new google.maps.LatLng(37.369158,-122.115449),a=new google.maps.LatLng(37.4366,-121.992621),c=new google.maps.LatLngBounds(o,a);i.fitBounds(c),window.addEventListener("resize",function(e){i.fitBounds(c)}),p=new google.maps.InfoWindow},l.initializeMarkers=function(){for(var t=0;d>t;t++){var o=l.markers()[t],a=new google.maps.Marker({position:new google.maps.LatLng(o.lat,o.lng),map:i,icon:icons[o.iconType].icon});o.setMapMarker(a),o.setActivate(n),a.addListener("click",e(o))}},l.filter=function(){a(null),l.filteredMarkers.removeAll();for(var e,n=0;d>n;n++)e=l.markers()[n],(-1!=e.name.toLowerCase().indexOf(l.query().toLowerCase())||-1!=e.address.toLowerCase().indexOf(l.query().toLowerCase()))&&l.filteredMarkers.push(e);a(i)},l.toggleListView=function(){var e=$(".list-data").css("display");"block"===e?($(".list-data").hide("slow"),$(".hide-list").hide(),$(".show-list").show(),e=!1):($(".list-data").show("slow"),$(".show-list").hide(),$(".hide-list").show(),e=!0)}},viewModel=new ViewModel;ko.applyBindings(viewModel),viewModel.initializeMap(),viewModel.initializeMarkers(),viewModel.query.subscribe(function(){viewModel.filter()});