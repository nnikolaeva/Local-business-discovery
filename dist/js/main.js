var places=[{name:"Clocktower Coffee Roasting Co.",address:"205 E Middlefield Rd #1A Mountain View, CA 94043",lat:37.3970472,lng:-122.0617372,iconType:"coffee"},{name:"Sufi Coffee Shop",address:"815 W El Camino Real Mountain View, CA 94040",lat:37.385884,lng:-122.0847306,iconType:"coffee"},{name:"Oh My Sushi",address:"2595 California St Mountain View, CA 94040",lat:37.4053954,lng:-122.1107026,iconType:"sushi"},{name:"Hon Sushi",address:"1477 Plymouth St Mountain View, CA 94043",lat:37.4163068,lng:-122.0795238,iconType:"sushi"},{name:"Satsuma Sushi",address:"705 E El Camino Real Mountain View, CA 94040",lat:37.3755308,lng:-122.0638239,iconType:"sushi"}],icons={sushi:{icon:"dist/images/sushi.png"},coffee:{icon:"dist/images/coffee.png"}},Marker=function(e){this.name=e.name,this.address=e.address,this.lat=e.lat,this.lng=e.lng,this.iconType=e.iconType,this.infoWindow=null,this.mapMarker=null,this.activate=null,this.setInfoWindow=function(e){this.infoWindow=e},this.setMapMarker=function(e){this.mapMarker=e},this.setActivate=function(e){this.activate=e}},ViewModel=function(){function e(e){return function(){i(e)}}function i(e){if(e.mapMarker.setAnimation(google.maps.Animation.BOUNCE),setTimeout(function(){e.mapMarker.setAnimation(null)},1400),null!==e.infoWindow)e.infoWindow.open(t,e.mapMarker);else{var i=e.lat+","+e.lng,o="https://maps.googleapis.com/maps/api/streetview?size=100x100&location="+i,s="O4L3T0YIVRWVHCWIQ1Y1UHUXUDRBQ3S4AXKT4ZIQTSIKQMNN",r="5KVONUBGB0YJZJFMTAIXKGCMRB15KEVAGRY2YWMCCZF03EXC",l="https://api.foursquare.com/v2/venues/search?client_id="+s+"&client_secret="+r+"&v=20130815&query="+e.name+"&intent=match&ll="+i;$.getJSON(l,function(i){var t="https://api.foursquare.com/v2/venues/"+i.response.venues[0].id+"?client_id="+s+"&client_secret="+r+"&v=20130815";$.getJSON(t,function(i){n(e,o,i.response.venue)}).error(function(){a(e)})}).error(function(){a(e)})}}function n(e,i,n){var a=document.createElement("div");a.setAttribute("class","info-window-container"),$("<img>",{"class":"info-image",src:""+i}).appendTo(a);var o=$("<div>",{"class":"content"}).appendTo(a);$("<h1>",{"class":"venue-name",text:""+n.name}).appendTo(o);var s=n.location.address+", "+n.location.city+", "+n.location.postalCode+", "+n.location.state;$("<h2>",{"class":"venue-address",text:""+s}).appendTo(o);var r="Rating: "+n.rating+"/10";$("<span>",{"class":"venue-rating",text:""+r}).appendTo(o),$("<a>",{"class":"details-link",href:""+n.canonicalUrl,text:"View details"}).appendTo(o),n.hasOwnProperty("phrases")&&($("<hr>").appendTo(o),$("<span>",{"class":"review",text:""+n.phrases[0].sample.text}).appendTo(o));var l=new google.maps.InfoWindow({content:a});e.setInfoWindow(l),l.open(t,e.mapMarker)}function a(e){var i=new google.maps.InfoWindow({content:"<div class='error-message'>Failed to load venue details from foursquare server</div>"});i.open(t,e.mapMarker)}function o(e){for(var i=0;i<l.filteredMarkers().length;i++)l.filteredMarkers()[i].mapMarker.setMap(e)}var t,s=37.4006792,r=-122.068216,l=this;this.markers=ko.observableArray([]),this.filteredMarkers=ko.observableArray([]),this.query=ko.observable(""),this.initializeMap=function(){places.forEach(function(e){l.markers.push(new Marker(e))});for(var e=0;e<l.markers().length;e++)l.filteredMarkers.push(l.markers()[e]);var i=document.getElementById("map-canvas"),n={center:new google.maps.LatLng(s,r),zoom:13,mapTypeId:google.maps.MapTypeId.ROADMAP,panControl:!1,zoomControl:!0,zoomControlOptions:{position:google.maps.ControlPosition.RIGHT_TOP},scaleControl:!0};t=new google.maps.Map(i,n);var a=new google.maps.LatLng(37.3989458,-122.1107519),o=new google.maps.LatLng(37.4024914,-122.0527303),c=new google.maps.LatLngBounds(a,o);t.fitBounds(c),window.addEventListener("resize",function(e){t.fitBounds(c)})},this.initializeMarkers=function(){for(var n=0;n<l.markers().length;n++){var a=l.markers()[n],o=new google.maps.Marker({position:new google.maps.LatLng(a.lat,a.lng),map:t,icon:icons[a.iconType].icon});a.setMapMarker(o),a.setActivate(i),o.addListener("click",e(a))}},this.filter=function(){o(null),l.filteredMarkers.removeAll();for(var e,i=0;i<l.markers().length;i++)e=l.markers()[i],(-1!=e.name.toLowerCase().indexOf(l.query().toLowerCase())||-1!=e.address.toLowerCase().indexOf(l.query().toLowerCase()))&&l.filteredMarkers.push(e);o(t)},this.isVisible=!0,this.toggleListView=function(){l.isVisible===!0?($(".list-data").hide("slow"),$(".show-list").text("View list"),l.isVisible=!1):($(".list-data").show("slow"),$(".show-list").text("Hide list"),l.isVisible=!0)}},viewModel=new ViewModel;ko.applyBindings(viewModel),viewModel.initializeMap(),viewModel.initializeMarkers(),viewModel.query.subscribe(function(){viewModel.filter()});