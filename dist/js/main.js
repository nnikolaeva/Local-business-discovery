var places=[{name:"Clocktower Coffee Roasting Co.",address:"205 E Middlefield Rd #1A Mountain View, CA 94043",lat:37.3970472,lng:-122.0617372,iconType:"coffee"},{name:"Sufi Coffee Shop",address:"815 W El Camino Real Mountain View, CA 94040",lat:37.385884,lng:-122.0847306,iconType:"coffee"},{name:"Oh My Sushi",address:"2595 California St Mountain View, CA 94040",lat:37.4053954,lng:-122.1107026,iconType:"sushi"},{name:"Hon Sushi",address:"1477 Plymouth St Mountain View, CA 94043",lat:37.4163068,lng:-122.0795238,iconType:"sushi"},{name:"Satsuma Sushi",address:"705 E El Camino Real Mountain View, CA 94040",lat:37.3755308,lng:-122.0638239,iconType:"sushi"}],icons={sushi:{icon:"dist/images/sushi.png"},coffee:{icon:"dist/images/coffee.png"}},Marker=function(e){this.name=e.name,this.address=e.address,this.lat=e.lat,this.lng=e.lng,this.iconType=e.iconType,this.infoWindow=null,this.mapMarker=null,this.activate=null,this.setInfoWindow=function(e){this.infoWindow=e},this.setMapMarker=function(e){this.mapMarker=e},this.setActivate=function(e){this.activate=e}},ViewModel=function(){function e(e){return function(){n(e)}}function n(e){if(e.mapMarker.setAnimation(google.maps.Animation.BOUNCE),setTimeout(function(){e.mapMarker.setAnimation(null)},1400),null!==e.infoWindow)e.infoWindow.open(t,e.mapMarker);else{var n=e.lat+","+e.lng,o="https://maps.googleapis.com/maps/api/streetview?size=100x100&location="+n,s="O4L3T0YIVRWVHCWIQ1Y1UHUXUDRBQ3S4AXKT4ZIQTSIKQMNN",r="5KVONUBGB0YJZJFMTAIXKGCMRB15KEVAGRY2YWMCCZF03EXC",l="https://api.foursquare.com/v2/venues/search?client_id="+s+"&client_secret="+r+"&v=20130815&query="+e.name+"&intent=match&ll="+n;$.getJSON(l,function(n){var t="https://api.foursquare.com/v2/venues/"+n.response.venues[0].id+"?client_id="+s+"&client_secret="+r+"&v=20130815";$.getJSON(t,function(n){a(e,o,n.response.venue)}).error(function(){i(e)})}).error(function(){i(e)})}}function a(e,n,a){var i=document.createElement("div");i.setAttribute("class","info-window-container"),$("<img>",{"class":"info-image",src:""+n}).appendTo(i);var o=$("<div>",{"class":"content"}).appendTo(i);$("<h1>",{"class":"venue-name",text:""+a.name}).appendTo(o);var s=a.location.address+", "+a.location.city+", "+a.location.postalCode+", "+a.location.state;$("<h2>",{"class":"venue-address",text:""+s}).appendTo(o);var r="Rating: "+a.rating+"/10";$("<span>",{"class":"venue-rating",text:""+r}).appendTo(o),$("<a>",{"class":"details-link",href:""+a.canonicalUrl,text:"View details"}).appendTo(o),a.hasOwnProperty("phrases")&&($("<hr>").appendTo(o),$("<span>",{"class":"review",text:""+a.phrases[0].sample.text}).appendTo(o));var l=new google.maps.InfoWindow({content:i});e.setInfoWindow(l),l.open(t,e.mapMarker)}function i(e){var n=new google.maps.InfoWindow({content:"<div class='error-message'>Failed to load venue details from foursquare server</div>"});n.open(t,e.mapMarker)}function o(e){for(var n=0;n<l.filteredMarkers().length;n++)l.filteredMarkers()[n].mapMarker.setMap(e)}var t,s=37.4006792,r=-122.068216,l=this;this.markers=ko.observableArray([]),this.filteredMarkers=ko.observableArray([]),this.query=ko.observable(""),this.initializeMap=function(){places.forEach(function(e){l.markers.push(new Marker(e))});for(var e=0;e<l.markers().length;e++)l.filteredMarkers.push(l.markers()[e]);var n=document.getElementById("map-canvas"),a={center:new google.maps.LatLng(s,r),zoom:13,mapTypeId:google.maps.MapTypeId.ROADMAP,panControl:!1,zoomControl:!0,zoomControlOptions:{position:google.maps.ControlPosition.RIGHT_TOP},scaleControl:!0};t=new google.maps.Map(n,a);var i=new google.maps.LatLng(37.3989458,-122.1107519),o=new google.maps.LatLng(37.4024914,-122.0527303),d=new google.maps.LatLngBounds(i,o);t.fitBounds(d),window.addEventListener("resize",function(e){t.fitBounds(d)})},this.initializeMarkers=function(){for(var a=0;a<l.markers().length;a++){var i=l.markers()[a],o=new google.maps.Marker({position:new google.maps.LatLng(i.lat,i.lng),map:t,icon:icons[i.iconType].icon});i.setMapMarker(o),i.setActivate(n),o.addListener("click",e(i))}},this.filter=function(){o(null),l.filteredMarkers.removeAll();for(var e,n=0;n<l.markers().length;n++)e=l.markers()[n],(-1!=e.name.toLowerCase().indexOf(l.query().toLowerCase())||-1!=e.address.toLowerCase().indexOf(l.query().toLowerCase()))&&l.filteredMarkers.push(e);o(t)},this.toggleListView=function(){var e=$(".list-data").css("display");console.log(e),"block"===e?($(".list-data").hide("slow"),$(".hide-list").hide(),$(".show-list").show(),e=!1):($(".list-data").show("slow"),$(".show-list").hide(),$(".hide-list").show(),e=!0)}},viewModel=new ViewModel;ko.applyBindings(viewModel),viewModel.initializeMap(),viewModel.initializeMarkers(),viewModel.query.subscribe(function(){viewModel.filter()});